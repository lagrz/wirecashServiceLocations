!function(window,$){"use strict";function template(tpl,data){for(var p in data)data.hasOwnProperty.call(data,p)&&(tpl=tpl.replace(new RegExp("{"+p+"}","g"),data[p]));return tpl}window.hasOwnProperty("WC")||(window.WC={}),window.WC.template=template,$.WCTemplate=template}(this,this.jQuery),function(window,$,google){"use strict";var GmapsAPILoader={init:function(options){options=$.extend({key:"",sensor:!1,gmapsLoaded:$.noop},options||{}),this.loadGmaps(options)},buildGlobalCallback:function(options){var cb="gmap_"+Date.now();return window[cb]=function(){google=window.google,options.gmapsLoaded(google),delete window[cb]},cb},buildUrl:function(cb,options){var base="https://maps.googleapis.com/maps/api/js?";if(0!==options.key.length){var params=$.extend({},options,{callback:cb,v:3});return delete params.gmapsLoaded,base+$.param(params)}throw new Error("Invalid set of options")},loadGmaps:function(options){if(google||0===options.key.length)options.gmapsLoaded(window.google);else{var s=document.createElement("script"),cb=this.buildGlobalCallback(options);try{var url=this.buildUrl(cb,options);s.type="text/javascript",s.src=url,$("head").append(s)}catch(e){}}}};window.hasOwnProperty("WC")||(window.WC={}),window.WC.GmapsAPILoader=GmapsAPILoader,$.WCGmapsAPILoader=GmapsAPILoader}(this,this.jQuery,this.google),function(window,$){"use strict";var GMaps=function(options){this.options=$.extend({},{container:$(),mapsOptions:{}},options||{}),this.map=null,this.geocoder=null,this._initGmaps()},fn=GMaps.fn=GMaps.prototype;fn._ensureList=function(obj){return $.isArray(obj)||(obj=[obj]),obj},fn._initGmaps=function(){this.geocoder=new google.maps.Geocoder;var latlng=new google.maps.LatLng(-104.8352628,37.9452861),myOptions={zoom:5,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(this.options.container[0],$.extend(myOptions,this.options.mapsOptions))},fn.geoCodeAddress=function(serviceLocation,callback){var addressRequest={};if($.isArray(serviceLocation.get("address"))){var location=$.map(serviceLocation.get("address"),function(val){return val.length?val+";":""}).join("");addressRequest.address=location}else 0!==serviceLocation.get("coordinates").latitude&&(addressRequest.latlng=new google.maps.LatLng(serviceLocation.get("coordinates").latitude,serviceLocation.get("coordinates").longitude));this.geocoder.geocode(addressRequest,function(results,status){if(status===google.maps.GeocoderStatus.OK&&results.length){var location=results[0].geometry.location;serviceLocation.set("gmapAddress",results[0].formatted_address),serviceLocation.set("gmapLatLng",new google.maps.LatLng(location.lat,location.lng)),callback({latlng:location,address:results[0].formatted_address,serviceLocation:serviceLocation})}else callback(!1)})},fn.setLatLng=function(serviceLocation){if(0!==serviceLocation.get("coordinates").latitude){var latlnt=new google.maps.LatLng(serviceLocation.get("coordinates").latitude,serviceLocation.get("coordinates").longitude);serviceLocation.set("gmapLatLng",latlnt)}},fn.createMarker=function(serviceLocation){serviceLocation=this._ensureList(serviceLocation);for(var i=0,s=serviceLocation.length;s>i;i++){var latlng=serviceLocation[i],marker=new google.maps.Marker({position:latlng.get("gmapLatLng"),map:null});latlng.set("gmapMarker",marker)}},fn.createMarkerEvents=function(serviceLocation,callbackOver,callbackOut,context){serviceLocation=this._ensureList(serviceLocation);for(var i=0,s=serviceLocation.length;s>i;i++){var location=serviceLocation[i],marker=location.get("gmapMarker");google.maps.event.addListener(marker,"mouseover",$.proxy(callbackOver,context,location)),google.maps.event.addListener(marker,"mouseout",$.proxy(callbackOut,context,location))}},fn._toggleMarker=function(serviceLocation,map){serviceLocation=this._ensureList(serviceLocation),map=map||null;for(var i=0,s=serviceLocation.length;s>i;i++){var location=serviceLocation[i];location.get("gmapMarker").setMap(map)}},fn.showMarker=function(serviceLocation){this._toggleMarker(serviceLocation,this.map)},fn.hideMarker=function(serviceLocation){this._toggleMarker(serviceLocation)},fn.center=function(serviceLocation){serviceLocation=this._ensureList(serviceLocation);for(var latlngbounds=new google.maps.LatLngBounds,i=0,s=serviceLocation.length;s>i;i++){var location=serviceLocation[i];latlngbounds.extend(location.get("gmapLatLng"))}this.map.setCenter(latlngbounds.getCenter()),serviceLocation.length>1?this.map.fitBounds(latlngbounds):this.map.setZoom(15)},window.hasOwnProperty("WC")||(window.WC={}),window.WC.GMaps=GMaps,$.WCGmaps=GMaps}(this,this.jQuery),function(win,$){"use strict";var Pager=function(opts){this.recs=$.extend({},{show:15,currPage:0,totalPages:0,total:0,url:"",params:{},onNoData:$.noop,onCreate:$.noop,onComplete:$.noop,onLoadingData:$.noop,onAjaxError:$.noop,onAjaxComplete:$.noop,onAjaxSuccess:$.noop,onBeforePage:$.noop,onPage:$.noop,data:[]},opts||{}),this.ajaxCall=null,this.recs.onCreate(this),this.ajaxSuccessCallback=$.proxy(this.ajaxSuccess,this),(0!==this.recs.data.length||0!==this.recs.total)&&(this.totalPages(),this.getData(0))},fn=Pager.fn=Pager.prototype;fn.getCurrentPage=function(){return this.recs.currPage},fn.getCurrentPageData=function(){return this.recs.data[this.recs.currPage]},fn.totalPages=function(){return this.recs.totalPages=Math.ceil(this.recs.total/this.recs.show),this.recs.totalPages},fn.calculateRange=function(pageNo){var s=pageNo*this.recs.show,e=(0>s?0:s)+(this.recs.show-1);if(pageNo===this.recs.totalPages-1){var remainder=this.recs.total%this.recs.show;s=0===remainder?s:this.recs.total-remainder,e=this.recs.total-1}var range={start:0>s?0:s,end:e>this.recs.total?this.recs.total-1:e};return range.end<=0&&(range.end=this.recs.show-1),range},fn.beforePaging=function(){this.recs.data[this.recs.currPage]&&this.recs.onBeforePage(this.recs.data[this.recs.currPage])},fn.getData=function(pageNo){var self=this;if(this.recs.params=$.extend(this.recs.params,this.calculateRange(pageNo)),this.recs.data[pageNo])return this.recs.onPage(this.recs.data[pageNo],this),this;if(!this.recs.url.length)throw new Error("No Ajax URL Provided");return console.log("INSIDE PAGINATOR: ",this.recs),this.ajaxCall=$.ajax(this.recs.url,{data:this.recs.params,type:"POST",beforeSend:this.recs.onLoadingData,error:this.recs.onAjaxError,complete:function(jqXHR,status){self.ajaxCall=null,self.recs.onAjaxComplete(jqXHR,status)},success:function(){var args=Array.prototype.slice.call(arguments,0);self.recs.onAjaxSuccess!==$.noop?(args.unshift(self.ajaxSuccessCallback),self.recs.onAjaxSuccess.apply(null,args)):self.ajaxSuccessCallback(args[0])}}),this},fn.ajaxDoneLoading=function(){return null===this.ajaxCall?!0:4===this.ajaxCall.readyState},fn.ajaxSuccess=function(json){var pageNo=this.recs.currPage;return 0===this.recs.data.length&&json.length>0?(this.recs.data[pageNo]=json,this.recs.onPage(this.recs.data[pageNo],this),void this.recs.onComplete(this.recs.data[pageNo],json,this)):0===json.length?void this.recs.onNoData(this):(this.recs.data[pageNo]=json,void this.recs.onPage(this.recs.data[pageNo],this))},fn.pageControls=function(){var first,prev,next,last,page=this.recs.currPage;return 0===page?(first=prev=!1,next=last=!0):page===this.recs.totalPages-1?(first=prev=!0,next=last=!1):first=prev=next=last=!0,{first:first,prev:prev,next:next,last:last}},fn.next=function(){return this.beforePaging(),this.recs.currPage++,this.getData(this.recs.currPage),this},fn.back=function(){return this.beforePaging(),this.recs.currPage--,this.getData(this.recs.currPage),this},fn.first=function(){return this.beforePaging(),this.recs.currPage=0,this.getData(0),this},fn.last=function(){return this.beforePaging(),this.recs.currPage=this.recs.totalPages-1,this.getData(this.recs.currPage),this},fn.page=function(pageNo){return this.beforePaging(),pageNo<this.recs.totalPages&&pageNo>=0&&(this.recs.currPage=pageNo,this.getData(pageNo)),this},fn.reset=function(){this.ajaxDoneLoading()||null===this.ajaxCall||this.ajaxCall.abort(),$.extend(this.recs,{currPage:0,totalPages:0,total:0,data:[]})},window.hasOwnProperty("WC")||(window.WC={}),window.WC.Pager=Pager,$.WCPaginator=Pager}(this,this.jQuery),function(window,$){"use strict";var ServiceLocation=function(data){this.data=$.extend({address:null,agent_code:null,coordinates:{latitude:0,longitude:0},country:null,currency:null,distance:0,hours_of_ops:null,name:null,phone:null,specialFields:{1:[],2:[]},gmapMarker:null,gmapLatLng:null,gmapAddress:null},data||{});try{this.data.distance=this.data.distance.toFixed(2)}catch(ignore){}},fn=ServiceLocation.fn=ServiceLocation.prototype;fn.get=function(key){return this.data.hasOwnProperty(key)?this.data[key]:void 0},fn.set=function(key,val){this.data[key]=val},fn.toJSON=function(){for(var exclude=["gmapMarker","gmapLatLng","gmapAddress"],clone=$.extend({},this.data),i=0,s=exclude.length;s>i;i++)delete clone[exclude[i]];return clone},fn.hasSpecialFields=function(section){return section!==ServiceLocation.SENDER||section!==ServiceLocation.RECIPIENT?null:0!==this.get("specialFields")[section].length},ServiceLocation.SENDER=1,ServiceLocation.RECIPIENT=2,ServiceLocation.COMPANY=1,ServiceLocation.PRODUCT=2,ServiceLocation.LOCATION=3,window.hasOwnProperty("WC")||(window.WC={}),window.WC.ServiceLocation=ServiceLocation,$.WCServiceLocation=ServiceLocation}(this,this.jQuery,this.google),function(window,$,google){"use strict";function elemId($elem){var id=$elem.attr("id");if(id)return id;do id="anonymous_element_"+elemIdCounter++;while($("#"+id)[0]);return $elem.attr("id",id),id}window.hasOwnProperty("WC")||(window.WC={});var elemIdCounter=0,ObjectCache={};window.WC.elemId=elemId;var ServiceLocationsView=function(options){this.options=$.extend({container:$(),tplMain:"",tplLocation:"",tplNoData:"",tplLoading:"",pagerShowPerPage:5,pagerTotalRecords:0,pagerRecordsUrl:"",pagerRecordsParams:{},additionalDataHandler:null,mapsAPIKey:"",pageFirst:".wc-first-page",pageLast:".wc-last-page",pageNext:".wc-page-next",pageBack:".wc-page-back",mapContainer:".wc-map-container",contentContainer:".wc-content-container",pageEnable:"wc-enable",pageDisable:"wc-disable",recordActive:"wc-active"},options||{}),this.container=this.options.container,this.pager=null,this.gmap=null,this.boundMethods={},google?this.init():$.WCGmapsAPILoader.init({key:this.options.mapsAPIKey,gmapsLoaded:$.proxy(this.init,this)})},fn=ServiceLocationsView.fn=ServiceLocationsView.prototype;fn.init=function(){var noDataCallback=$.proxy(this._noData,this);this.pager=new $.WCPaginator({show:this.options.pagerShowPerPage,total:this.options.pagerTotalRecords,url:this.options.pagerRecordsUrl,params:this.options.pagerRecordsParams,onNoData:noDataCallback,onAjaxError:noDataCallback,onCreate:$.proxy(function(pager){if($.isFunction(this.options.tplMain)){var html=this.options.tplMain(this.options.pagerRecordsParams);this.container.html(html)}else this.container.html(this.options.tplMain);this.gmap=new $.WCGmaps({container:this.container.find(this.options.mapContainer)}),this.container.trigger("WCService:create",[this]),pager.ajaxDoneLoading()&&pager.getData(0)},this),onBeforePage:$.proxy(this._beforePage,this),onComplete:$.proxy(this._firstRun,this),onLoadingData:$.proxy(this._loading,this),onAjaxSuccess:$.proxy(this._handleData,this),onPage:$.proxy(this._showPage,this)})},fn._beforePage=function(serviceLocations){this.gmap.hideMarker(serviceLocations),this.container.trigger("WCService:beforePage",[this])},fn._showPage=function(serviceLocations){for(var location,content="",tplIsFunction=$.isFunction(this.options.tplLocation),i=0,s=serviceLocations.length;s>i;i++){location=serviceLocations[i];try{var data=$.extend({},this.options.pagerRecordsParams,location.toJSON());data=null!==this.options.additionalDataHandler?this.options.additionalDataHandler(data):data,content+=tplIsFunction?this.options.tplLocation(data):$.WCTemplate(this.options.tplLocation,data)}catch(e){}}this.container.find(this.options.contentContainer).html(content),this.boundMethods.hasOwnProperty("first")&&this._updatePagerButtons(),this.gmap.showMarker(serviceLocations),this.gmap.center(serviceLocations),this.container.trigger("WCService:onPage",[this])},fn._handleData=function(done,data){if("true"===data.result){0===this.pager.recs.totalPages&&(this.pager.recs.total=data.data.total,this.pager.totalPages());var locations=$.map(data.data.data,$.proxy(function(obj){var location=new $.WCServiceLocation(obj);return this.gmap.setLatLng(location),this.gmap.createMarker(location),this.gmap.createMarkerEvents(location,this._markerMouseEnter,this._markerMouseLeave,this),location},this));done(locations)}else done([]);this.container.trigger("WCService:onData",[data,this])},fn._loading=function(){if($.isFunction(this.options.tplLoading)){var html=this.options.tplLoading(this.options.pagerRecordsParams);this.container.find(this.options.contentContainer).html(html)}else this.container.find(this.options.contentContainer).html(this.options.tplLoading);this._updatePagerButtons({first:!1,prev:!1,next:!1,last:!1}),this.container.trigger("WCService:onLoading",[this])},fn._noData=function(){if($.isFunction(this.options.tplNoData)){var html=this.options.tplNoData(this.options.pagerRecordsParams);this.container.find(this.options.contentContainer).html(html)}else this.container.find(this.options.contentContainer).html(this.options.tplNoData);this.container.find(this.options.mapContainer).hide(),$.each(["pageFirst","pageLast","pageNext","pageBack"],$.proxy(function(index,elem){this.container.find(this.options[elem]).hide()},this)),this.container.trigger("WCService:onNoData",[this])},fn._firstRun=function(){var container=this.container;this.boundMethods.first=[container.find(this.options.pageFirst),$.proxy(this.pager.first,this.pager)],this.boundMethods.last=[container.find(this.options.pageLast),$.proxy(this.pager.last,this.pager)],this.boundMethods.next=[container.find(this.options.pageNext),$.proxy(this.pager.next,this.pager)],this.boundMethods.prev=[container.find(this.options.pageBack),$.proxy(this.pager.back,this.pager)],$.each(["first","last","next","prev"],$.proxy(function(index,item){this.boundMethods[item][0].length&&this.boundMethods[item][0].on("click",this.boundMethods[item][1]).addClass(this.options.pageEnable)},this)),this._updatePagerButtons(),container.find("[data-agentCode]").length&&(container.on("mouseenter","[data-agentCode]",$.proxy(this._onHover,this)),container.on("mouseleave","[data-agentCode]",$.proxy(this._onMouseLeave,this))),this.container.trigger("WCService:onFirstRun",[this])},fn._onHover=function(event){var target=$(event.target);if(target.is("[data-id]")||(target=target.closest("[data-id]")),target.length){var id=parseInt(target.data("id"),10),data=this.pager.getCurrentPageData();this.gmap.hideMarker(data);for(var location,i=0,s=data.length;s>i;i++)location=data[i],parseInt(location.get("id"),10)===id&&this.gmap.showMarker(location)}},fn._onMouseLeave=function(){var data=this.pager.getCurrentPageData();this.gmap.showMarker(data)},fn._updatePagerButtons=function(pagerControls){var controls=pagerControls||this.pager.pageControls();$.each(["first","last","next","prev"],$.proxy(function(index,item){this.boundMethods.hasOwnProperty(item)&&(this.boundMethods[item][0].removeClass(this.options.pageEnable+" "+this.options.pageDisable),this.boundMethods[item][0].off("click",this.boundMethods[item][1]).addClass(this.options.pageDisable),controls[item]&&this.boundMethods[item][0].on("click",this.boundMethods[item][1]).addClass(this.options.pageEnable).removeClass(this.options.pageDisable))},this))},fn._markerMouseEnter=function(serviceLocation){this.container.find('[data-agentcode="'+serviceLocation.get("agent_code")+'"]').addClass(this.options.recordActive)},fn._markerMouseLeave=function(serviceLocation){this.container.find('[data-agentcode="'+serviceLocation.get("agent_code")+'"]').removeClass(this.options.recordActive)},fn.getLocationById=function(id){id=parseInt(id,10);for(var original=id,rec=function(index,data){return data.get("id")===id?(id=data,!1):void 0},i=0,s=this.pager.recs.data.length;s>i&&($.each(this.pager.recs.data[i],rec),id===original);i++);return id===original?null:id},fn.changeSearchConditions=function(params){$.each(this.pager.recs.data,$.proxy(function(ignore,list){this.gmap.hideMarker(list)},this)),this.pager.reset(),$.extend(this.pager.recs.params,params||{}),this.pager.getData(0)},window.WC.ServiceLocationsView=ServiceLocationsView,$.WCServiceLocationsView=ServiceLocationsView,$.WCServiceLocationsView.create=function(options){var obj,id=elemId($(options.container));return obj=ObjectCache.hasOwnProperty(id)?ObjectCache[id]:ObjectCache[id]=new ServiceLocationsView(options)},$.fn.WCServiceLocationsView=function(options){var ret,args=Array.prototype.slice.call(arguments,1),id=elemId($(this[0]));if(ObjectCache.hasOwnProperty(id)){var obj=ObjectCache[id];switch(options){case"first":case"last":case"next":case"back":obj.pager[options].apply(obj.pager,args),ret=obj;break;case"totalPages":case"getCurrentPageData":ret=obj.pager[options].apply(obj.pager,args);break;case"currentPage":ret=obj.pager.getCurrentPage();break;case"page":args.length&&(obj.pager[options].apply(obj.pager,args),ret=obj);break;default:ret=obj}return ret}return this.each(function(){var opts=jQuery.extend({},options);opts.container=$(this),$.WCServiceLocationsView.create(opts)})}}(this,this.jQuery,this.google);